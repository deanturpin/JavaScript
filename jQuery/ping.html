<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'> 

<script src='jquery-2.2.4.min.js'></script>

<script>
$(document).ready(function(){

		// Array to hold all the valid IPs in the hosts file
		var IPs = [];

		// AJAX complete handler
		$(document).ajaxComplete(function(event, request, settings) {

			// Handle pings
			if (RegExp('ping').test(settings.url)) {

				// Check result
				var color = 'red';
				if (request.responseText == 1)
					color = 'green';

				// Extract the IP from the request
				var ip = settings.url.split('?').pop();

				$('span:contains(' + ip + ')').css('color', color);

			} else {

				// Otherwise it must be the hosts file request
				// Extract hosts
				var hosts = request.responseText.split('\n');

				// Iterate through each IP in the hosts file
				for (var i = 0; i < hosts.length; ++i) {

					// Create a span for each line
					$('p#hosts').append('<span>' + hosts[i] + '</span><br>');

					// Extract IPs
					var ip = RegExp('^[0-9\.]{7,}').exec(hosts[i]);
					if (ip)
						IPs.push(ip);
				}
			}
		});

		// Ping each IP in the hosts file
		function ping(){
			$.each(IPs, function(index, value){
				$.ajax('http://localhost/cgi-bin/ping?' + value);
			});
		};

		// Update cycle
		setInterval(function() {
			$('p#timestamp').text(new Date);
			ping();
		}, 2000);

		// Create page elements
		$('body').append('<p id=timestamp>tbc</p>');
		$('body').append('<p id=hosts></p>');

		// Fetch hosts file
		$.ajax('hosts');
});
</script>

</head>
<body style='background-color: black; color: grey; font-family: monospace;'>
<!-- To see here nothing -->
</body>
</html>
